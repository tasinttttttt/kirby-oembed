(function(){"use strict";function n(t,e,i,o,s,a,m,f){var d=typeof t=="function"?t.options:t;return e&&(d.render=e,d.staticRenderFns=i,d._compiled=!0),{exports:t,options:d}}const l={props:{disabled:{type:Boolean,default:!1},help:{type:String,default:""},label:{type:String,default:""},liststyle:{type:String,default:"table"},name:{type:[String,Number],default:""},required:{type:Boolean,default:!1},type:{type:String,default:"oembed"},value:{type:Array,default(){return[]}},debug:{type:Boolean,default:!1}},data(){return{embedCode:void 0,error:"",filledStatus:"closed",info:{},isLoading:!1,limit:1,url:""}},computed:{embedId(){return"embed-"+this._uid},sortedInfo(){const t=this.sortObjectKeys(this.info);return Object.assign({},{title:t.title,description:t.description,provider_name:t.provider_name,provider_url:t.provider_url,html:t.html,width:t.width,height:t.height,thumbnail_url:t.thumbnail_url,...t})}},watch:{value(t){this.url=t}},mounted(){this.debug&&console.log(this.value),this.value&&this.value.length&&(this.url=this.value[0],this.url&&(this.isLoading=!0,this.getEmbed(this.url).then(t=>{this.updateUi(t)}).catch(t=>{this.error=t,this.$refs.dialog.open(),this.debug&&console.warn(t)}).finally(()=>{this.isLoading=!1})))},methods:{sortObjectKeys(t){return Object.keys(t).sort().reduce((e,i)=>(e[i]=t[i],e),{})},onDelete(t){t&&(t.preventDefault(),t.stopPropagation()),this.embedCode=void 0,this.url="",this.value="",this.$emit("input",this.value)},onUrlValidate(t){t&&(t.preventDefault(),t.stopPropagation()),this.embedCode=void 0,this.isLoading=!0,this.getEmbed(this.url).then(e=>{this.updateUi(e),this.value=this.url,this.$emit("input",this.value)}).catch(e=>{this.error=e,this.$refs.dialog.open(),this.debug&&console.warn(e)}).finally(()=>{this.isLoading=!1})},toggle(t){this.filledStatus=t,this.$nextTick(()=>{})},getEmbed(t){return new Promise((e,i)=>{if(t){const o={url:t};this.$api.post("oembed/preview",o).then(s=>{if(s&&s.data){if(s.data.xdebug_message||s.xdebug_message)throw Error(s.data.xdebug_message||s.xdebug_message);return s.data}else throw Error()}).then(s=>{e(s)}).catch(s=>{this.debug&&console.log(s,this.$t("oembed.error."+s.message)),i(s&&s.message&&this.$t("oembed.error."+s.message)||this.$t("oembed.error.generic"))})}else i(this.$t("oembed.error.no_url_provided"))})},updateUi(t){this.embedCode=t.html,this.info=t,this.debug&&console.log(this.info)}}};var r=function(){var e=this,i=e._self._c;return i("k-field",e._b({class:["k-oembed-field",e.status],attrs:{input:e._uid}},"k-field",e.$props,!1),[i("div",{staticClass:"k-input k-oembed-input",attrs:{"data-theme":"field"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],ref:"input",staticClass:"k-text-input",attrs:{disabled:e.isLoading||e.disabled,placeholder:e.$t("oembed.placeholder")},domProps:{value:e.url},on:{input:function(o){o.target.composing||(e.url=o.target.value)}}}),i("k-button",{class:[{disabled:!e.url.length}],attrs:{theme:"positive",icon:e.isLoading?"refresh":"check",disabled:e.isLoading},on:{click:e.onUrlValidate}},[e._v(" "+e._s(e.$t("oembed.validate"))+" ")]),i("k-button",{class:[{disabled:!e.url.length}],attrs:{theme:"negative",icon:e.isLoading?"dots":"cancel",disabled:e.isLoading},on:{click:e.onDelete}},[e._v(" "+e._s(e.$t("oembed.delete"))+" ")])],1),i("k-dialog",{ref:"dialog",on:{close:function(o){e.error=""}}},[i("k-text",{staticClass:"k-error-text"},[e._v(" "+e._s(e.$t("oembed.name"))+": "+e._s(e.$t("oembed.error"))+" "),i("k-error-details",{staticClass:"k-error-details",domProps:{innerHTML:e._s(e.error)}})],1),i("k-button-group",{attrs:{slot:"footer"},slot:"footer"},[i("k-button",{attrs:{icon:"check"},on:{click:function(o){return e.$refs.dialog.close()}}},[e._v(" "+e._s(e.$t("confirm"))+" ")])],1)],1),i("div",{staticClass:"k-oembed-container"},[e.embedCode?i("div",{staticClass:"oembed-container"},[i("div",{staticClass:"k-oembed-embed",attrs:{id:e.embedId},domProps:{innerHTML:e._s(e.embedCode)}}),i("div",{class:["content",e.liststyle]},e._l(e.sortedInfo,function(o,s){var a;return i("div",{staticClass:"content-block"},[i("div",{staticClass:"title"},[e._v(" "+e._s(e._f("capitalize")(!((a=e.$t("oembed.embed."+s))!=null&&a.includes("oembed"))&&e.$t("oembed.embed."+s)||s))+" ")]),i("div",{staticClass:"value"},[e._v(" "+e._s(o)+" ")])])}),0)]):e._e()]),e.embedCode?e._e():i("k-empty",{staticClass:"k-oembed-empty",attrs:{icon:"code"},on:{click:function(o){return e.$refs.input.focus()}}},[e._v(" "+e._s(e.$t("oembed.empty"))+" ")])],1)},u=[],c=n(l,r,u);const h=c.exports;panel.plugin("tasinttttttt/oembed",{fields:{oembed:h}})})();
